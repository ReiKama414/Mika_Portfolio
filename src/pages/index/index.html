<div class="lg:container lg:mx-auto lg:px-16 xl:px-20 2xl:px-24 overflow-hidden custom-container">
    <!-- <h1>é¦–é å…§å®¹</h1> -->
    <div class="flex justify-between wapper_container_hand" style="min-height: 45rem;">
        <div id="lottie-container-hand" class="self-start flex-1 pt-12"></div>
        <div class="text-5xl xl:text-6xl custom-font-Fahkwang self-end pb-24 lg:pb-36" style="letter-spacing: 0.34em; color: #606060;">
            <h3 class="pb-4"> Hi, thereğŸ‘‡</h3>
            <h3> Itâ€™s </h3>
        </div>
    </div>
    <div class="flex items-center justify-between h-screen" style="min-height: 40rem;">
        <div id="lottie-container-p" class="w-3/5"></div>
        <div class="inline-flex flex-col items-center px-16 w-2/5" style="letter-spacing: 0.01em; color: #606060;">
            <div id="lottie-container-mika_characters" class="relative"></div>
            <h3 class="text-xl custom-font-Fahkwang">A UI/UX designer foucused on business probability and create solution in a fun way</h3>
            <div class="self-end me-3">
                <a href="/about" class="url-inner move-horizontal flex items-center pt-4">
                    Learn more
                    <img src="src/assets/icons/icon _arrow down circle_.png" class="w-14 lg:w-16 ps-1" alt="Arrow" />
                </a>
            </div>
        </div>
    </div>
    <div id="block-container" class="grid grid-cols-2 gap-x-10 gap-y-14 mt-30 px-4 lg:px:6 xl:px-16 2xl:px-28"></div>
</div>

<script>
    var baseUrl_inner = window.location.pathname.startsWith('/Mika_Portfolio') ? '/Mika_Portfolio' : '';
    var innerLink = document.querySelector('.url-inner');
    innerLink.href = baseUrl_inner + '/about';
    // æ–¹å¡Šæ•¸é‡ (ç›®å‰å¯ä»¥åˆ° 16)
    var blockCount = 6;

    // åœ–ç‰‡å’Œé€£çµçš„é™£åˆ—
    var blockItems = [
        {   // 1
            image: "src/assets/images/example_image_1.png",
            link: "https://mika-chus-portfolio.webflow.io/product",
            appName: "æ™¯å¾·ç¥ APP",
            appCot1: "è¨­è¨ˆæ€è€ƒéç¨‹è¨˜éŒ„",
            appCot2: "å¾0åˆ°1ç¨ç«‹è¨­è¨ˆ",
        },
        {   // 2
            image: "src/assets/images/example_image_2.png",
            link: `${baseUrl_inner}/kinghoksu`,
            appName: "æ™¯å¾·ç¥ APP",
            appCot1: "æº–ç”¢å“ä¸Šç·šç¶²é ",
            appCot2: "APPç”¢å“APPé‡é»åŠŸèƒ½ä»‹ç´¹",
        },
        {   // 3
            image: "src/assets/images/example_image_3.png",
            link: "",
            appName: "æ™¯å¾·ç¥ APP",
            appCot1: "ç™¼è²¡é‡‘è¨­è¨ˆæ€è€ƒ",
            appCot2: "æŠŠç¾å¯¦ä¸­è™§æç™¼è²¡é‡‘æ¥­å‹™åšæ•¸ä½è½‰åŒ–",
        },
        {   // 4
            image: "https://images.unsplash.com/photo-1683802175679-d77c014e6a2c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1155&q=80",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 5
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 6
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 7
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 8
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 9
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 10
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 11
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 12
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 13
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 14
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 15
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
        {   // 16
            image: "",
            link: "",
            appName: "",
            appCot1: "",
            appCot2: "",
        },
    ];

    generateBlocks(blockCount, blockItems);
    observeBlocks();

    function generateBlocks(blockCount, blockItems) {
        var blocksArea = $('#block-container');

        for (var i = 0; i < blockCount; i++) {
            var blockData = blockItems[i];

            var image = blockData.image;
            var link = blockData.link;
            var appName = blockData.appName;
            var appContent1 = blockData.appCot1;
            var appContent2 = blockData.appCot2;

            var block = $('<div>').addClass('block aspect-square overflow-hidden');
            var content = $('<div>').addClass('content flex flex-col justify-end w-full h-full px-8 pb-6');

            if (image !== "") {
                // var img = $('<img>').attr('src', image)
                //                     .addClass('w-full h-full object-cover')
                //                     .on('error', function() { $(this).hide(); });
                // content.append(img);
                // æ·»åŠ èƒŒæ™¯åœ–ç‰‡çš„ CSS
                content.css({
                    'background-image': 'url("' + image + '")',
                    'background-position': 'center',
                    'background-size': 'cover',
                });

                var gradientDiv = $('<div>').addClass('gradient-div');
                content.append(gradientDiv);
            }

            if (link !== "") {
                var a = $('<a>').attr('href', link)
                                .addClass('w-full h-full')
                                .attr('target', '_blank')
                                .attr('rel', 'noreferrer noopener')
                                .append(content);
                block.append(a);
            } else {
                block.append(content);
            }

            if (appName !== "") {
                var appNameDiv = $('<div>').addClass('app-name custom-font-Soukou').text(appName);
                    content.append(appNameDiv);
            }

            if (appContent1 !== "") {
                var appContent1Div = $('<div>').addClass('app-contentA custom-font-NotoSans text-base font-normal').text(appContent1);
                content.append(appContent1Div);
            }

            if (appContent2 !== "") {
                var appContent2Div = $('<div>').addClass('app-contentB custom-font-NotoSans text-sm font-thin').text(appContent2);
                content.append(appContent2Div);
            }

            blocksArea.append(block);
        }
    }
    function observeBlocks() {
        var observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                var block = entry.target;
                block.classList.add('block-float-up');
                observer.unobserve(block);
                }
            });
        });

        var blocks = document.querySelectorAll('.block');
            blocks.forEach(function(block) {
            observer.observe(block);
        });
    }

    var lottieContainer_hand = document.getElementById("lottie-container-hand");
    lottie.loadAnimation({
        container: lottieContainer_hand,
        renderer: "svg",
        loop: true,
        autoplay: true,
        path: 'src/assets/images/json/hand2.json'
        // path: "https://uploads-ssl.webflow.com/637d811b57fdde36a2c0ad03/63872dd803666f1e3415cc91_hand2.json"
    });

    var lottieContainer_p = document.getElementById('lottie-container-p');
    var lottieContainer_mika_characters = document.getElementById('lottie-container-mika_characters');

    var animation_p = lottie.loadAnimation({
        container: lottieContainer_p,
        renderer: 'svg',
        loop: false,
        autoplay: false,
        path: 'src/assets/images/json/sit.json'
        // path: 'https://uploads-ssl.webflow.com/637d811b57fdde36a2c0ad03/63846e13ee7073da028730b6_sit.json'
    });

    var animation_mika_characters = lottie.loadAnimation({
        container: lottieContainer_mika_characters,
        renderer: 'svg',
        loop: false,
        loop: false,
        path: 'src/assets/images/json/mika_s.json'
        // path: 'https://uploads-ssl.webflow.com/637d811b57fdde36a2c0ad03/6384684aee7073c54386d6bf_mika2.json'
    });

    // è¨­ç½®å‹•ç•«æ’­æ”¾é€²åº¦çš„å‡½æ•¸
    function setAnimationProgress(anim, progress) {
        anim.goToAndStop(anim.getDuration(true) * progress, true);
    }

    // è¨ˆç®—æ»‘å‹•æ–¹å‘å’Œåˆ°ä¸­é»è·é›¢çš„å‡½æ•¸
    function calculateScrollValues(anim, containerDiv) {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        var windowHeight = window.innerHeight;
        var containerOffsetTop = containerDiv.offsetTop;
        var containerHeight = containerDiv.offsetHeight;
        var scrollDistance = scrollTop + windowHeight / 2 - (containerOffsetTop + containerHeight / 2);
        var scrollDirection = scrollDistance > 0 ? 'down' : 'up';
        var scrollProgress = Math.abs(scrollDistance) / (windowHeight / 2);
        // console.log(containerOffsetTop, containerOffsetTop, containerHeight, scrollDistance);
        // console.log(scrollDirection, scrollProgress);
        
        // æ ¹æ“šæ»‘å‹•æ–¹å‘å’Œé€²åº¦æ§åˆ¶å‹•ç•«æ’­æ”¾
        if (scrollDirection === 'down') {
            setAnimationProgress(anim, 0.99);
        } else {
            if (scrollProgress >= 1) {
                setAnimationProgress(anim, 0.01);
            } else {
                setAnimationProgress(anim, 1 - scrollProgress);
            }
        }
        
        // if (containerDiv === lottieContainer_p) {
        //     if (scrollDistance <= 0) {
        //         containerDiv.style.transform = `translateY(${window.pageYOffset + windowHeight / 2 - (containerOffsetTop + containerHeight / 2.5)}px)`;
        //     } else {
        //         containerDiv.style.transform = 'translateY(0%)';
        //     }
        // }
    }
    
    window.addEventListener('scroll', () => {
        calculateScrollValues(animation_p, lottieContainer_p);
        calculateScrollValues(animation_mika_characters, lottieContainer_mika_characters);
    });

    animation_p.play();
    animation_mika_characters.play();

    var limits = 15.0;

    $('#block-container').on('mousemove', '.block', function (e) {
        var rect = e.target.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;
        var offsetX = x / rect.width;
        var offsetY = y / rect.height;

        var rotateY = (offsetX) * (limits * 2) - limits;
        var rotateX = (offsetY) * (limits * 2) - limits;

        var shadowOffsetX = (offsetX) * 32 - 16;
        var shadowOffsetY = (offsetY) * 32 - 16;

        $(this).css({
            "transition": "transform .15s",
            "box-shadow":
            (1 / 6) * -shadowOffsetX + "px " + (1 / 6) * -shadowOffsetY + "px 3px rgba(0, 0, 0, 0.051), " +
            (2 / 6) * -shadowOffsetX + "px " + (2 / 6) * -shadowOffsetY + "px 7.2px rgba(0, 0, 0, 0.073), " +
            (3 / 6) * -shadowOffsetX + "px " + (3 / 6) * -shadowOffsetY + "px 13.6px rgba(0, 0, 0, 0.09), " +
            (4 / 6) * -shadowOffsetX + "px " + (4 / 6) * -shadowOffsetY + "px 24.3px rgba(0, 0, 0, 0.107), " +
            (5 / 6) * -shadowOffsetX + "px " + (5 / 6) * -shadowOffsetY + "px 45.5px rgba(0, 0, 0, 0.129), " +
            -shadowOffsetX + "px " + -shadowOffsetY + "px 109px rgba(0, 0, 0, 0.18)",
            transform: "perspective(2000px) rotateX(" + -rotateX + "deg) rotateY(" + rotateY + "deg)"
        });
    });

    $('#block-container').on('mouseleave', '.block', function (e) {
        $(".block").css({"box-shadow": "0px 0px 3px rgba(0, 0, 0, 0.051), 0px 0px 7.2px rgba(0, 0, 0, 0.073), 0px 0px 13.6px rgba(0, 0, 0, 0.09), 0px 0px 24.3px rgba(0, 0, 0, 0.107), 0px 0px 45.5px rgba(0, 0, 0, 0.129)", "transform": "scale(1.0)"});
    });

</script>